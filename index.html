<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body class="bg-fixed bg-cover bg-center text-gray-900" style="background-image: url('bg.jpg');">
  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
  <h1 class="text-3xl font-bold text-indigo-700 mb-6 animate__animated animate__fadeInDown">
    ğŸ“˜ Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
  </h1>

  <!-- Ø§Ù„Ø¨Ø­Ø« -->
  <div class="bg-white shadow-lg rounded-2xl p-4 w-full max-w-md mb-6 animate__animated animate__fadeInUp">
    <label for="studentCode" class="block mb-2 text-lg font-semibold text-gray-700">Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
    <input id="studentCode" type="text" 
      class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-400 focus:outline-none mb-3">
    <button onclick="searchStudent()" 
      class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">
      ğŸ” Ø¨Ø­Ø«
    </button>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
  <div id="studentInfo" class="w-full max-w-2xl bg-white shadow-md rounded-2xl p-4 animate__animated animate__fadeIn"></div>

  <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
  <h2 class="text-xl font-bold text-indigo-700 mt-8 mb-4">ğŸ¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>
  <div id="videos" class="grid gap-3 w-full max-w-2xl"></div>

  <!-- ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ -->
  <h2 class="text-xl font-bold text-indigo-700 mt-8 mb-4">ğŸ“ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„</h2>
  <div id="contacts" class="grid gap-3 w-full max-w-2xl"></div>

  <script>
    // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø´ÙŠØªØ§Øª (CSV) â€” Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù„ÙŠÙ†ÙƒØ§Øª Ø¹Ù†Ø¯Ùƒ
    const SHEET_STUDENTS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=635336311&single=true&output=csv";
    const SHEET_VIDEOS   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=849351073&single=true&output=csv";
    const SHEET_CONTACTS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=218257892&single=true&output=csv";


    // Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© CSV (Ø¨Ø³ÙŠØ·Ø©ØŒ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙØ§ØµÙ„ komma)
    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const rows = text.trim().split("\n").map(r => r.split(","));
      const headers = rows[0].map(h => h.trim());
      return rows.slice(1).map(row => {
        let obj = {};
        headers.forEach((h, i) => obj[h] = row[i] ? row[i].trim() : "");
        return obj;
      });
    }

    // Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙØ§Ø±ØºØ©
    function safeNumber(val) {
      return (val === "" || isNaN(parseFloat(val))) ? 0 : parseFloat(val);
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨
    async function searchStudent() {
      const code = document.getElementById("studentCode").value.trim();
      if (!code) {
        document.getElementById("studentInfo").innerHTML = `<p class="text-red-600 font-bold">Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</p>`;
        return;
      }

      const students = await fetchCSV(SHEET_STUDENTS);
      const student = students.find(s => (s.code || "") === code);

      if (!student) {
        document.getElementById("studentInfo").innerHTML =
          `<p class="text-red-600 font-bold">âš ï¸ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>`;
        return;
      }

      // Ø¯Ø±Ø¬Ø§Øª (Ø´ÙˆÙ Ø¥Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø­Ø±ÙˆÙ Ø§Ù„ØµØºÙŠØ±Ø©)
      const w1_exam = safeNumber(student.w1_exam);
      const w1_homework = safeNumber(student.w1_homework);
      const w1_tesmie3 = safeNumber(student.w1_tesmie3);

      const w2_exam = safeNumber(student.w2_exam);
      const w2_homework = safeNumber(student.w2_homework);
      const w2_tesmie3 = safeNumber(student.w2_tesmie3);

      const w3_exam = safeNumber(student.w3_exam);
      const w3_homework = safeNumber(student.w3_homework);
      const w3_tesmie3 = safeNumber(student.w3_tesmie3);

      const w4_exam = safeNumber(student.w4_exam);
      const w4_homework = safeNumber(student.w4_homework);
      const w4_tesmie3 = safeNumber(student.w4_tesmie3);

      const finalExam = safeNumber(student.finalExam);

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ (ÙƒÙ„ Ø§Ù…ØªØ­Ø§Ù† 10ØŒ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ 10ØŒ ÙƒÙ„ ØªØ³Ù…ÙŠØ¹ 10ØŒ Ø§Ù„Ø´Ø§Ù…Ù„ 20)
      const total = w1_exam + w1_homework + w1_tesmie3 +
                    w2_exam + w2_homework + w2_tesmie3 +
                    w3_exam + w3_homework + w3_tesmie3 +
                    w4_exam + w4_homework + w4_tesmie3 +
                    finalExam;

      const maxTotal = (4 * 10) + (4 * 10) + (4 * 10) + 20; // 140
      const percent = ((total / maxTotal) * 100).toFixed(2);

      // Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø®ÙŠØ§Ø± Ø¬Ù…Ø§Ù„ÙŠ)
      const percentClass = percent >= 75 ? "text-green-700" : percent >= 50 ? "text-yellow-700" : "text-red-700";

      // Ø¹Ø±Ø¶
      document.getElementById("studentInfo").innerHTML = `
        <h2 class="text-2xl font-bold text-indigo-700 mb-4">ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${student.name || "-"}</p>
        <p><strong>Ø§Ù„ØµÙ:</strong> ${student.class || "-"}</p>
        <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${student.group || "-"}</p>

        <h3 class="text-xl font-semibold text-gray-700 mt-4 mb-2">ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>

        <div class="overflow-x-auto">
          <table class="w-full border border-gray-300 rounded-lg overflow-hidden text-center">
            <thead class="bg-indigo-600 text-white">
              <tr>
                <th class="p-2">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                <th class="p-2">Ø§Ù…ØªØ­Ø§Ù† (10)</th>
                <th class="p-2">ÙˆØ§Ø¬Ø¨ (10)</th>
                <th class="p-2">ØªØ³Ù…ÙŠØ¹ (10)</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b"><td>1</td><td>${w1_exam}</td><td>${w1_homework}</td><td>${w1_tesmie3}</td></tr>
              <tr class="border-b bg-gray-50"><td>2</td><td>${w2_exam}</td><td>${w2_homework}</td><td>${w2_tesmie3}</td></tr>
              <tr class="border-b"><td>3</td><td>${w3_exam}</td><td>${w3_homework}</td><td>${w3_tesmie3}</td></tr>
              <tr class="border-b bg-gray-50"><td>4</td><td>${w4_exam}</td><td>${w4_homework}</td><td>${w4_tesmie3}</td></tr>
            </tbody>
          </table>
        </div>

        <p class="mt-4 font-semibold">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„: <span class="text-indigo-700">${finalExam}/20</span></p>
        <p class="mt-2 font-bold ${percentClass}">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${percent}%</p>
      `;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    async function loadVideos() {
      const videos = await fetchCSV(SHEET_VIDEOS);
      const container = document.getElementById("videos");
      container.innerHTML = videos.map(v => `
        <div class="bg-white shadow rounded-lg p-3 border hover:bg-indigo-50 transition">
          <p class="font-semibold text-indigo-700">${v.title}</p>
          <p class="text-sm text-gray-600">${v.note || ""}</p>
          <a href="${v.link}" target="_blank" class="text-blue-600 underline">Ù…Ø´Ø§Ù‡Ø¯Ø©</a>
        </div>
      `).join("");
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ§ØµÙ„
    async function loadContacts() {
      const contacts = await fetchCSV(SHEET_CONTACTS);
      const container = document.getElementById("contacts");
      container.innerHTML = contacts.map(c => {
        let link = (c.type === "whatsapp") ? `https://wa.me/${c.number}` : `tel:${c.number}`;
        return `
          <div class="bg-white shadow rounded-lg p-3 border hover:bg-green-50 transition">
            <p class="font-semibold">${c.label}</p>
            <a href="${link}" target="_blank" class="text-green-600 underline">ØªÙˆØ§ØµÙ„</a>
          </div>
        `;
      }).join("");
    }

    // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    loadVideos();
    loadContacts();
  </script>
</body>
</html>
